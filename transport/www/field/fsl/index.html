{% extends "templates/web.html" %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="/field/fsl/fsl.css">
{% endblock %}

{% block page_content %}

<script>
  // Make CSRF token available to fsl.js
  window.csrf_token = "{{ csrf_token }}";
</script>

<div class="fsl-page">
  <div class="fsl-card">
    <div class="fsl-header">
      <h2>Field Service Log</h2>
      <small>Offline-capable driver form</small>
    </div>

    <!-- QR info -->
    <div class="fsl-row">
      <div class="fsl-meta">
        <span><b>QR Token:</b> <span id="tokenStatus">Reading…</span></span>
      </div>
    </div>

    <!-- Optional driver display (driverCanonicalId or a nicer label via JS) -->
    <div class="fsl-row">
      <div class="fsl-meta">
        <span><b>Driver:</b> <span id="driverDisplay">Loading…</span></span>
      </div>
      <div class="fsl-subtle">
        Driver ID is fetched from your logged-in user; there is no manual input.
      </div>
    </div>

    <hr />

    <!-- Service data -->
    <div class="fsl-section-title">Service Data</div>

    <div class="fsl-row">
      <label class="fsl-label" for="qtyOrWeight">Qty / Weight</label>
      <input
        id="qtyOrWeight"
        class="fsl-input"
        type="number"
        step="0.01"
        placeholder="Enter quantity or weight"
      />
    </div>

    <div class="fsl-row">
      <label class="fsl-label" for="photoInput">Photo</label>
      <input
        id="photoInput"
        class="fsl-file"
        type="file"
        accept="image/*"
        capture="environment"
      />
      <small id="photoStatus" class="fsl-subtle">No photo selected</small>
    </div>

    <hr />

    <!-- Device info -->
    <div class="fsl-section-title">Device Info</div>
    <div class="fsl-row">
      <div class="fsl-meta">
        <span><b>Timestamp:</b> <span id="timeStatus">Not set</span></span>
      </div>
    </div>

    <!-- Actions -->
    <div class="fsl-actions">
      <button id="btnSave" type="button" class="fsl-btn fsl-btn-primary">
        Save Draft
      </button>
    </div>

    <!-- Status -->
    <div class="fsl-status">
      <b>Status:</b> <span id="status" class="fsl-status-text"></span>
    </div>

    <div class="fsl-subtle">
      Submissions are saved offline if network is unavailable and will be
      re-sent automatically when you are online again.
    </div>
  </div>
</div>

<script src="/field/fsl/register-sw.js"></script>
<script src="/field/fsl/fsl.js"></script>

{% endblock %}
